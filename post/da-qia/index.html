<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>打卡 | Waterjiao</title>
<link rel="shortcut icon" href="https://waterjiao.github.io/favicon.ico?v=1583652619856">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://waterjiao.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://waterjiao.github.io">
  <img class="avatar" src="https://waterjiao.github.io/images/avatar.png?v=1583652619856" alt="">
  </a>
  <h1 class="site-title">
    Waterjiao
  </h1>
  <p class="site-description">
    温故而知新
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          首页
        </a>
      
    
      
        <a href="/archives" class="menu">
          归档
        </a>
      
    
      
        <a href="/tags" class="menu">
          标签
        </a>
      
    
      
        <a href="/post/about" class="menu">
          关于
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              打卡
            </h2>
            <div class="post-info">
              <time class="post-time">
                · 2020-02-13 ·
              </time>
              
                <a href="https://waterjiao.github.io/tag/tWfE2Yt2T" class="post-tag">
                  # Study
                </a>
              
            </div>
            
              <div class="post-feature-image" style="background-image: url('https://waterjiao.github.io/post-images/da-qia.jpg')">
              </div>
            
            <div class="post-content">
              <h1 id="21天打卡计划">21天打卡计划</h1>
<p>Day1<br>
学习课程：《趣谈网络协议》第13讲<br>
打卡笔记：<br>
在网络层，Socket 函数需要指定是 IPv4 还是 IPv6， AF_INET 和 AF_INET6。还要指定是 TCP 还是 UDP，为 SOCK_STREAM 和 SOCK_DGRAM。<br>
对于TCP，服务端要先调用bind函数，给这个Socket赋值IP和Port，再调用listen函数进行监听。客户端用过connect函数发起连接，经过三次握手，这里注意，一旦握手成功，服务端的accept函数会返回另一个Socket，监听Socket和已连接Socket。<br>
对于UDP，没有三次握手，服务端调用bind和listen，由于不需要维护连接状态，只要有一个Socket就可以和多个客户端通信，客户端和服务端都调用sendto和recvfrom。<br>
服务端维护多个Socket连接的方法：<br>
1）多进程<br>
2）多线程<br>
3）IO多路复用，一个线程维护多个Socket<br>
4）IO多路复用，epoll<br>
文件描述符（file descriptor）是内核为了高效管理已被打开的文件所创建的索引，其是一个非负整数（通常是小整数），用于指代被打开的文件，所有执行I/O操作的系统调用都通过文件描述符。</p>
<h1 id="21天打卡计划-2">21天打卡计划</h1>
<p>Day2<br>
学习课程：《趣谈网络协议》第14讲<br>
打卡笔记：<br>
1.应用层 http协议，简单例子，访问网页时，首先根据url通过DNS转化为IP地址，传输层为TCP协议，经过三次握手 进行连接，四次挥手 断开连接，中间过程，IP层，数据链路层，物理层，经过ARP查找MAC地址，发送到目标。而QUIC基于 UDP连接，不需要三次握手，节省资源，提高了性能和效率;<br>
2.http报文包括 请求行 、首部、正文实体，请求行包含方法、SP、URL、版本，首部包含首部字段名、SP、字段值、cr/if。实体就是正文实体。其中，方法就是GET、POST、PUT和DELETE方法。<br>
3.http1.1发送请求时串行，http2.0发送请求时并行，http2.0可以通过头压缩、分帧、二进制编码、多路复用来提升传输效率。<br>
4.Quic 全称 quick udp internet connection ，“快速 UDP 互联网连接”，（和英文 quick 谐音，简称“快”）是由 google 提出的使用 udp 进行多路并发传输的协议。<br>
1）自定义连接机制，不基于四元组，基于随机ID<br>
2）自定义重传机制<br>
3）无阻塞多路复用<br>
4）自定义流量控制。</p>
<h1 id="21天打卡计划-3">21天打卡计划</h1>
<p>Day3<br>
学习课程：《趣谈网络协议》第15讲<br>
打卡笔记：<br>
公钥和私钥是成对的，它们互相解密。公钥加密，私钥解密。私钥数字签名，公钥验证。<br>
http协议不安全，在安全要求下，一般使用https协议，加密的方法有两种对称和不对称。https协议中首先数字证书保证了服务端公钥的可靠性，客户端从CA库里查询确认可靠性，就用证书中公钥去加密pre-master，服务端收到加密后的数据，用自己的私钥去解开，得到pre-master，然后两边都有了①客户端的随机数 ②服务端的随机数 ③pre-master 然后就各自通过计算得到一样的值，就当做公钥。后面就是对称加密的数据传输。这个过程中，对称加密的公钥从来没有在网络上传输过，就很安全了。ca证书中的解密是通过不对称的加密方式实现的，而且保证了公钥的可靠性，所以这里不怕别人拿到公钥，因为私钥他没有，也不怕别人伪造私钥和公钥，因为ca保证了公钥是可靠的。</p>
<h1 id="21天打卡计划-4">21天打卡计划</h1>
<p>Day4<br>
学习课程：《趣谈网络协议》第16讲<br>
打卡笔记：<br>
直播过程：主播端采样+编码+推流至服务端，服务端接流+流处理+分发至分发网络，观众从分发网络拉流+解码+播发。<br>
视频是图片的序列，因此分为三种帧，I帧，P帧，B帧。每一帧又分成多个片，每个片分成多个宏块，压成二进制流为网络提取层单元NALU，NALU之间通过特殊的起始标识符分隔，在每个I帧前要插入单独保存SPS和PPS的NALU，形成NALU序列。<br>
推流使用RTMP协议，基于TCP，主要是确定版本号和时间戳，在传输数据时，需要创建一个流Stream，通过这个Stream来推流publish。推送到流媒体集群的视频流经过转码和分发，可以被客户端通过 RTMP 协议拉取，然后组合为 NALU，解码成视频格式进行播放。这样就可以看直播了。</p>
<h1 id="21天打卡计划-5">21天打卡计划</h1>
<p>Day5<br>
学习课程：《趣谈网络协议》第17讲<br>
打卡笔记：<br>
对于FTP服务器而言，FTP 有两种工作模式，分别是主动模式（PORT）和被动模式（PASV）。两种都是通过21端口进行连接，再开放20或大于1024的端口来进行数据传输。<br>
P2P就是利用tracker中心服务器来记录每个下载者的信息，大家又利用记录了tarcker服务器地址的种子.torrent文件来进行下载，其中还记录了各个下载块。<br>
DHT（Distributed Hash Table）去中心化网络，使用Kademlia 协议，就是每个加入到DHT网络中的节点都要负责存储部分资源信息和成员联系信息。利用哈希值来计算。DHT节点信息划分是通过按位数进行维护，节点信息维护是通过维护列表进行。Kademlia算法中，每个节点只有4个指令，分别是PING、STORE、FIND_NODE和FIND_VALUE。</p>
<h1 id="21天打卡计划-6">21天打卡计划</h1>
<p>Day6<br>
学习课程：《趣谈网络协议》第18讲<br>
打卡笔记：<br>
DNS的作用就是将网站名称转化为IP地址，DNS服务器又根DNS服务器，顶级域DNS服务器和权威DNS服务器。<br>
DNS的解析流程：客户端问www.baidu.com的IP是什么，本地域名服务器进行查询，没有就咨询根域名服务器，根域名服务器回复说去咨询.com顶级域名服务器，顶级域名服务器又说去咨询www.baidu.com的权威DNS服务器吧，本地DNS就去问权威DNS服务器，权威DNS服务器将IP地址返回，客户端与目标建立连接。<br>
DNS的另外一个功能，就是负载均衡。在域名和 IP 的映射过程中，给了应用基于域名做负载均衡的机会，可以是简单的负载均衡，也可以根据地址和运营商做全局的负载均衡。</p>
<h1 id="21天打卡计划-7">21天打卡计划</h1>
<p>Day7<br>
学习课程：《趣谈网络协议》第19讲<br>
打卡笔记：<br>
传统DNS<br>
1）域名缓存问题，在一次请求后会在本地缓存，没有及时更新导致问题出现<br>
2）域名转发问题，由于运营商DNS服务器将其转发，导致跨运营商访问问题出现<br>
3）出口NAT问题，从NAT口出来的IP无法判断，导致跨运营商访问问题出现<br>
4）域名更新问题，和1）关联性比较大<br>
5）解析延迟问题，本地DNS，根DNS，顶级DNS，权威DNS，有延时<br>
HTTPDNS<br>
不走传统的 DNS 解析，而是自己搭建基于 HTTP 协议的 DNS 服务器集群，分布在多个地点和多个运营商。当客户端需要 DNS 解析的时候，通过 SDK 使用 HTTP 协议进行请求这个服务器集群，得到就近的地址。</p>
<h1 id="21天打卡计划-8">21天打卡计划</h1>
<p>Day8<br>
学习课程：《趣谈网络协议》第20讲<br>
打卡笔记：<br>
CDN 的全称是 Content Delivery Network，即内容分发网络。<br>
CDN的基本原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求。<br>
CDN 和电商系统的分布式仓储系统一样，分为中心节点、区域节点、边缘节点，而数据缓存在离用户最近的位置。<br>
CDN 最擅长的是缓存静态数据，除此之外还可以缓存流媒体数据，这时候要注意使用防盗链。它也支持动态数据的缓存，一种是边缘计算的生鲜超市模式，另一种是链路优化的冷链运输模式。</p>
<h1 id="21天打卡计划-9">21天打卡计划</h1>
<p>Day9<br>
学习课程：《趣谈网络协议》第21讲<br>
打卡笔记：<br>
数据中心指用于安置计算机系统及相关部件的设施，例如电信和储存系统。一般它包含冗余和备用电源，冗余数据通信连接，环境控制和各种安全设备。<br>
数据中心分为三层。服务器连接到接入层，然后是汇聚层，再然后是核心层，最外面是边界路由器和安全设备。<br>
数据中心的所有链路都需要高可用性。服务器需要绑定网卡，交换机需要堆叠，三层设备可以通过等价路由，二层设备可以通过 TRILL 协议。<br>
随着云和大数据的发展，东西流量相对于南北流量越来越重要，因而演化为叶脊网络结构。<br>
大二层是指二层互联从汇聚层上升核心层，全部在一个广播域内。</p>
<h1 id="21天打卡计划-10">21天打卡计划</h1>
<p>Day10<br>
学习课程：《趣谈网络协议》第22讲<br>
打卡笔记：<br>
VPN（ Virtual Private Network）虚拟专用网，就是利用开放的公众网络，建立专用数据传输通道，将远程的分支机构、移动办公人员等连接起来。VPN 通过隧道技术在公众网络上仿真一条点到点的专线，是通过利用一种协议来传输另外一种协议的技术，这里面涉及三种协议：乘客协议、隧道协议和承载协议。完全基于软件的 IPsec VPN 可以保证私密性、完整性、真实性、简单便宜，但是性能稍微差一些；MPLS-VPN 综合和 IP 转发模式和 ATM 的标签转发模式的优势，性能较好，但是需要从运营商购买。</p>
<h1 id="21天打卡计划-11">21天打卡计划</h1>
<p>Day11<br>
学习课程：《Go语言核心36讲》第15讲<br>
打卡笔记：<br>
Go语言中以下值是不可寻址的：</p>
<ul>
<li>常量的值 // const num = 123  _ = &amp;num</li>
<li>基本类型值的字面量 // _ = &amp;(123)</li>
<li>对各种字面量的索引表达式和切片表达式的结果值</li>
<li>对字符串变量的索引表达式和切片表达式的结果值</li>
<li>对字典变量的索引表达式的结果值</li>
<li>函数字面量和方法字面量，以及对它们的调用表达式的结果值</li>
<li>结构体字面量的字段值</li>
<li>类型转换表达式的结果值</li>
<li>类型断言表达式的结果值</li>
<li>接收表达式的结果值</li>
</ul>
<h1 id="21天打卡计划-12">21天打卡计划</h1>
<p>Day12<br>
学习课程：《趣谈网络协议》第23讲<br>
打卡笔记：<br>
手机上网过程：<br>
1）手机开机后，寻找周围的eNodeB基站，然后发送Attach Request<br>
2）eNodeB将请求发送给MME<br>
3）MME去请求手机，认证和鉴权<br>
4）当MME通过了手机的认证，分配隧道，和SGW创建session，分配隧道t1，告诉SGW给MME分配一个隧道口<br>
5）SGW 转头向 PGW 请求建立一个会话，为 PGW 的控制面分配一个隧道 ID t2，也给 PGW 的数据面分配一个隧道 ID t3，并且请求 PGW 给自己的控制面和数据面分配隧道 ID<br>
6）PGW 回复 SGW ，使用自己的控制面隧道 ID t2，回复里面携带着给 SGW 控制面分配的隧道 ID t4 和控制面的隧道 ID t5，隧道建设完成。双方请求对方，都要带着对方给自己分配的隧道 ID，从而标志是这个手机的请求。<br>
7）接下来 SGW 回复 MME 说“创建会话成功”，使用自己的隧道 ID t1 访问 MME，回复里面有给 MME 分配隧道 ID t6，也有 SGW 给 eNodeB 分配的隧道 ID t7。<br>
8）当 MME 发现后面的隧道都建设成功之后，就告诉 eNodeB，“后面的隧道已经建设完毕，SGW 给你分配的隧道 ID 是 t7，你可以开始连上来了，但是你也要给 SGW 分配一个隧道 ID”。<br>
9）eNodeB 告诉 MME 自己给 SGW 分配一个隧道，ID 为 t8。<br>
10）MME 将 eNodeB 给 SGW 分配的隧道 ID t8 告知 SGW，从而前面的隧道也建设完毕。<br>
手机可以上网了。</p>
<h1 id="21天打卡计划-13">21天打卡计划</h1>
<p>Day13<br>
学习课程：《深入剖析Kubernetes》第13讲<br>
打卡笔记：<br>
Namespace 做隔离，Cgroups 做限制，rootfs 做文件系统。<br>
Pod 里的所有容器，共享的是同一个 Network Namespace，并且可以声明共享同一个 Volume。<br>
查看容器在宿主机的Namespace文件，在。。。<br>
为 Kubernetes 开发一个网络插件时，应该重点考虑的是如何配置这个 Pod 的 Network Namespace，而不是每一个用户容器如何使用你的网络配置。<br>
“组合”操作，正是容器设计模式里最常用的一种模式，它的名字叫：sidecar。<br>
yaml文件中Init Contaniner定义的容器在spec.containers定义的用户容器先启动。<br>
Pod，实际上是在扮演传统基础设施里“虚拟机”的角色；而容器，则是这个虚拟机里运行的用户程序。</p>
<h1 id="21天打卡计划-14">21天打卡计划</h1>
<p>Day18<br>
学习课程：《趣谈网络协议》第26讲<br>
打卡笔记：<br>
对于公有云上的虚拟机，仅仅开放需要的端口，将其他的端口一概关闭，只要通过安全措施守护好这个唯一的入口就可以了。采用的方式常常是用 ACL（Access Control List，访问控制列表）来控制 IP 和端口。<br>
PREROUTING - 路由判断 - FORWARD - OUTPIUT - POSTROUTING<br>
｜                           ｜<br>
INPUT                      路由判断<br>
｜                           ｜<br>
上层协议栈</p>
<p>PREROUTING，INPUT，FORWARD，OUTPIUT，POSTROUTING对应的5个节点<br>
iptables 的表分为四种：raw–&gt;mangle–&gt;nat–&gt;filter。<br>
mangle 表主要是修改数据包，包含：PREROUTING，INPUT，FORWARD，OUTPIUT，POSTROUTING链。<br>
Netfilter 的连接跟踪（conntrack）功能，用于识别nat转换。<br>
源地址转换 (Snat)：iptables -t nat -A -s 私网 IP -j Snat --to-source 外网 IP<br>
目的地址转换 (Dnat)：iptables -t nat -A -PREROUTING -d 外网 IP -j Dnat --to-destination 私网 IP</p>
<h1 id="21天打卡计划-15">21天打卡计划</h1>
<p>Day19<br>
学习课程：《趣谈网络协议》第27讲<br>
打卡笔记：<br>
在 Linux 下，可以通过 TC 控制网络的 QoS，主要就是通过队列的方式。<br>
云中的流量控制主要通过队列进行的，队列分为两大类：无类别队列规则和基于类别的队列规则。<br>
无类别排队规则有pfifo_fast，这是一种不把网络包分类的技术；随机公平队列（Stochastic Fair Queuing）；令牌桶规则（TBF，Token Bucket Filte）。<br>
在云中网络 Openvswitch 中，主要使用的是分层令牌桶规则（HTB），将总的带宽在一棵树上按照配置的比例进行分配，并且在一个分支不用的时候，可以借给另外的分支，从而增强带宽利用率。</p>
<h1 id="21天打卡计划-16">21天打卡计划</h1>
<p>Day20<br>
学习课程：《趣谈网络协议》第28讲<br>
打卡笔记：<br>
要对不同用户的网络进行隔离，解决 VLAN 数目有限的问题，需要通过 Overlay 的方式，常用的有 GRE 和 VXLAN。<br>
GRE 是一种点对点的隧道模式，VXLAN 支持组播的隧道模式，它们都要在某个 Tunnel Endpoint 进行封装和解封装，来实现跨物理机的互通。<br>
OpenvSwitch 可以作为 Tunnel Endpoint，通过设置流表的规则，将虚拟机网络和物理机网络进行隔离、转换。<br>
ovs基本命令：<br>
ovs-vsctl add-br br0<br>
ovs-vsctl add-port br0 eth0<br>
ovs-vsctl add-bond br0 port0 eth2 eht3<br>
ovs-vsctl del-port br0 eth0<br>
ovs-vsctl del-port br0 br0 //会报错<br>
ovs-vsctl del-port br0 port0<br>
删除bridge ovs-vsctl bel-br br0<br>
查看bridge ovs-ofctl show br0<br>
查看流表项 ovs-ofctl dump-flows br0</p>
<h1 id="21天打卡计划-17">21天打卡计划</h1>
<p>Day21<br>
学习课程：《趣谈网络协议》第29讲<br>
打卡笔记：<br>
容器是一种比虚拟机更加轻量级的隔离方式，主要通过 namespace 和 cgroup 技术进行资源的隔离，namespace 用于负责看起来隔离，cgroup 用于负责用起来隔离。<br>
增加routerns的命名空间 ip netns add routerns<br>
转发开关打开 ip netns exec routerns sysctl -w net.ipv4.ip_forward=1<br>
创建网卡连接在br0的网桥上 ovs-vsctl -- add-port br0 taprouter -- set Interface taprouter type=internal -- set Interface taprouter external-ids:iface-status=active -- set Interface taprouter external-ids:attached-mac=fa:16:3e:84:6e:cc<br>
容器网络连接到物理网络的方式和虚拟机很像，通过桥接的方式实现一台物理机上的容器进行相互访问，如果要访问外网，最简单的方式还是通过 NAT。<br>
和虚拟机一样，不同物理机上的容器需要相互通信，那么要知道容器的网络类型有4种</p>
<ol>
<li>host</li>
<li>none</li>
<li>bridge</li>
<li>container<br>
要使不同节点的容器互通，就要使用iptables规则做转换或者使用overlay方式，如kubernetes中CNI。</li>
</ol>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">下一篇</div>
            <a href="https://waterjiao.github.io/post/arts-di-shi-wu-zhou">
              <h3 class="post-title">
                ARTS-第十五周
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/waterjiao" target="_blank">Waterjiao</a> | 
  <a class="rss" href="https://waterjiao.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
